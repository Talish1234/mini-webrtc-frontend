{"ast":null,"code":"import Button from\"@material-ui/core/Button\";import IconButton from\"@material-ui/core/IconButton\";import TextField from\"@material-ui/core/TextField\";import AssignmentIcon from\"@material-ui/icons/Assignment\";import PhoneIcon from\"@material-ui/icons/Phone\";import React,{useEffect,useRef,useState}from\"react\";import{CopyToClipboard}from\"react-copy-to-clipboard\";import Peer from\"simple-peer\";import io from\"socket.io-client\";import\"./App.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const socket=io.connect('http://localhost:5000');function App(){const[me,setMe]=useState(\"\");const[stream,setStream]=useState();const[receivingCall,setReceivingCall]=useState(false);const[caller,setCaller]=useState(\"\");const[callerSignal,setCallerSignal]=useState();const[callAccepted,setCallAccepted]=useState(false);const[idToCall,setIdToCall]=useState(\"\");const[callEnded,setCallEnded]=useState(false);const[name,setName]=useState(\"\");const myVideo=useRef(null);const userVideo=useRef(null);const connectionRef=useRef(null);useEffect(()=>{navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(stream=>{setStream(stream);if(myVideo.current){myVideo.current.srcObject=stream;}});socket.on(\"me\",id=>{setMe(id);});socket.on(\"callUser\",data=>{setReceivingCall(true);setCaller(data.from);setName(data.name);setCallerSignal(data.signal);});},[]);const callUser=id=>{const peer=new Peer({initiator:true,trickle:false,stream:stream});peer.on(\"signal\",data=>{socket.emit(\"callUser\",{userToCall:id,signalData:data,from:me,name:name});});peer.on(\"stream\",stream=>{if(userVideo.current){userVideo.current.srcObject=stream;}});socket.on(\"callAccepted\",signal=>{setCallAccepted(true);peer.signal(signal);});connectionRef.current=peer;};const answerCall=()=>{setCallAccepted(true);const peer=new Peer({initiator:false,trickle:false,stream:stream});peer.on(\"signal\",data=>{socket.emit(\"answerCall\",{signal:data,to:caller});});peer.on(\"stream\",stream=>{if(userVideo.current){userVideo.current.srcObject=stream;}});peer.signal(callerSignal);connectionRef.current=peer;};const leaveCall=()=>{setCallEnded(true);connectionRef.current.destroy();};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h1\",{style:{textAlign:\"center\",color:'#fff'},children:\"Zoomish\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"video-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"video\",children:stream&&/*#__PURE__*/_jsx(\"video\",{playsInline:true,muted:true,ref:myVideo,autoPlay:true,style:{width:\"300px\"}})}),/*#__PURE__*/_jsx(\"div\",{className:\"video\",children:callAccepted&&!callEnded?/*#__PURE__*/_jsx(\"video\",{playsInline:true,ref:userVideo,autoPlay:true,style:{width:\"300px\"}}):null})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"myId\",children:[/*#__PURE__*/_jsx(TextField,{id:\"filled-basic\",label:\"Name\",variant:\"filled\",value:name,onChange:e=>setName(e.target.value),style:{marginBottom:\"20px\"}}),/*#__PURE__*/_jsx(CopyToClipboard,{text:me,style:{marginBottom:\"2rem\"},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(AssignmentIcon,{fontSize:\"large\"}),children:\"Copy ID\"})}),/*#__PURE__*/_jsx(TextField,{id:\"filled-basic\",label:\"ID to call\",variant:\"filled\",value:idToCall,onChange:e=>setIdToCall(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"call-button\",children:[callAccepted&&!callEnded?/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:leaveCall,children:\"End Call\"}):/*#__PURE__*/_jsx(IconButton,{color:\"primary\",\"aria-label\":\"call\",onClick:()=>callUser(idToCall),children:/*#__PURE__*/_jsx(PhoneIcon,{fontSize:\"large\"})}),idToCall]})]}),/*#__PURE__*/_jsx(\"div\",{children:receivingCall&&!callAccepted?/*#__PURE__*/_jsxs(\"div\",{className:\"caller\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[name,\" is calling...\"]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:answerCall,children:\"Answer\"})]}):null})]})]});}export default App;","map":{"version":3,"names":["Button","IconButton","TextField","AssignmentIcon","PhoneIcon","React","useEffect","useRef","useState","CopyToClipboard","Peer","io","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","socket","connect","App","me","setMe","stream","setStream","receivingCall","setReceivingCall","caller","setCaller","callerSignal","setCallerSignal","callAccepted","setCallAccepted","idToCall","setIdToCall","callEnded","setCallEnded","name","setName","myVideo","userVideo","connectionRef","navigator","mediaDevices","getUserMedia","video","audio","then","current","srcObject","on","id","data","from","signal","callUser","peer","initiator","trickle","emit","userToCall","signalData","answerCall","to","leaveCall","destroy","children","style","textAlign","color","className","playsInline","muted","ref","autoPlay","width","label","variant","value","onChange","e","target","marginBottom","text","startIcon","fontSize","onClick"],"sources":["/home/kernel/Desktop/webrtc/frontend/src/App.js"],"sourcesContent":["import Button from \"@material-ui/core/Button\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport TextField from \"@material-ui/core/TextField\"\nimport AssignmentIcon from \"@material-ui/icons/Assignment\"\nimport PhoneIcon from \"@material-ui/icons/Phone\"\nimport React, { useEffect, useRef, useState } from \"react\"\nimport { CopyToClipboard } from \"react-copy-to-clipboard\"\nimport Peer from \"simple-peer\"\nimport io from \"socket.io-client\"\nimport \"./App.css\"\n\nconst socket = io.connect('http://localhost:5000')\n\nfunction App() {\n    const [me, setMe] = useState(\"\")\n    const [stream, setStream] = useState()\n    const [receivingCall, setReceivingCall] = useState(false)\n    const [caller, setCaller] = useState(\"\")\n    const [callerSignal, setCallerSignal] = useState()\n    const [callAccepted, setCallAccepted] = useState(false)\n    const [idToCall, setIdToCall] = useState(\"\")\n    const [callEnded, setCallEnded] = useState(false)\n    const [name, setName] = useState(\"\")\n    const myVideo = useRef(null)\n    const userVideo = useRef(null)\n    const connectionRef = useRef(null)\n\n    useEffect(() => {\n        navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then((stream) => {\n            setStream(stream)\n            if (myVideo.current) {\n                myVideo.current.srcObject = stream\n            }\n        })\n\n        socket.on(\"me\", (id) => {\n            setMe(id)\n        })\n\n        socket.on(\"callUser\", (data) => {\n            setReceivingCall(true)\n            setCaller(data.from)\n            setName(data.name)\n            setCallerSignal(data.signal)\n        })\n    }, [])\n\n    const callUser = (id) => {\n        const peer = new Peer({\n            initiator: true,\n            trickle: false,\n            stream: stream\n        })\n\n        peer.on(\"signal\", (data) => {\n            socket.emit(\"callUser\", {\n                userToCall: id,\n                signalData: data,\n                from: me,\n                name: name\n            })\n        })\n\n        peer.on(\"stream\", (stream) => {\n            if (userVideo.current) {\n                userVideo.current.srcObject = stream\n            }\n        })\n\n        socket.on(\"callAccepted\", (signal) => {\n            setCallAccepted(true)\n            peer.signal(signal)\n        })\n\n        connectionRef.current = peer\n    }\n\n    const answerCall = () => {\n        setCallAccepted(true)\n        const peer = new Peer({\n            initiator: false,\n            trickle: false,\n            stream: stream\n        })\n\n        peer.on(\"signal\", (data) => {\n            socket.emit(\"answerCall\", { signal: data, to: caller })\n        })\n\n        peer.on(\"stream\", (stream) => {\n            if (userVideo.current) {\n                userVideo.current.srcObject = stream\n            }\n        })\n\n        peer.signal(callerSignal)\n        connectionRef.current = peer\n    }\n\n    const leaveCall = () => {\n        setCallEnded(true)\n        connectionRef.current.destroy()\n    }\n\n    return (\n        <>\n            <h1 style={{ textAlign: \"center\", color: '#fff' }}>Zoomish</h1>\n            <div className=\"container\">\n                <div className=\"video-container\">\n                    <div className=\"video\">\n                        {stream && <video playsInline muted ref={myVideo} autoPlay style={{ width: \"300px\" }} />}\n                    </div>\n                    <div className=\"video\">\n                        {callAccepted && !callEnded ?\n                            <video playsInline ref={userVideo} autoPlay style={{ width: \"300px\" }} /> :\n                            null}\n                    </div>\n                </div>\n                <div className=\"myId\">\n                    <TextField\n                        id=\"filled-basic\"\n                        label=\"Name\"\n                        variant=\"filled\"\n                        value={name}\n                        onChange={(e) => setName(e.target.value)}\n                        style={{ marginBottom: \"20px\" }}\n                    />\n                    <CopyToClipboard text={me} style={{ marginBottom: \"2rem\" }}>\n                        <Button variant=\"contained\" color=\"primary\" startIcon={<AssignmentIcon fontSize=\"large\" />}>\n                            Copy ID\n                        </Button>\n                    </CopyToClipboard>\n\n                    <TextField\n                        id=\"filled-basic\"\n                        label=\"ID to call\"\n                        variant=\"filled\"\n                        value={idToCall}\n                        onChange={(e) => setIdToCall(e.target.value)}\n                    />\n                    <div className=\"call-button\">\n                        {callAccepted && !callEnded ? (\n                            <Button variant=\"contained\" color=\"secondary\" onClick={leaveCall}>\n                                End Call\n                            </Button>\n                        ) : (\n                            <IconButton color=\"primary\" aria-label=\"call\" onClick={() => callUser(idToCall)}>\n                                <PhoneIcon fontSize=\"large\" />\n                            </IconButton>\n                        )}\n                        {idToCall}\n                    </div>\n                </div>\n                <div>\n                    {receivingCall && !callAccepted ? (\n                        <div className=\"caller\">\n                            <h1>{name} is calling...</h1>\n                            <Button variant=\"contained\" color=\"primary\" onClick={answerCall}>\n                                Answer\n                            </Button>\n                        </div>\n                    ) : null}\n                </div>\n            </div>\n        </>\n    )\n}\n\nexport default App\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}